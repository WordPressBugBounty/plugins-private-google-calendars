(()=>{"use strict";const e=window.wp.blocks,t=window.wp.blockEditor,n=window.wp.element,a=window.wp.components,s=window.ReactJSXRuntime,i=JSON.stringify(window.pgc_trans.fullcalendar_version>=5?{headerToolbar:{start:"prev,next today",center:"title",end:"dayGridMonth,timeGridWeek,listWeek"}}:{header:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,listWeek"}},null,2);function c(e,t,n,a){const s=Object.assign({},e);s[n]=a;const i={};return i[t]=s,i}function d(e){try{return""===e||Object.keys(JSON.parse(e)).length>0}catch(e){return!1}}(0,e.registerBlockType)("pgc-plugin/calendar",{title:"Private Google Calendars",icon:"calendar",category:"widgets",attributes:{calendars:{type:"object",default:{}},config:{type:"object",default:{filter:"top",theme:"",eventpopup:!1,eventlink:!1,eventdescription:!1,eventlocation:!1,eventattendees:!1,eventattachments:!1,eventcreator:!1,eventcalendarname:!1}},fullcalendarconfig:{type:"string",default:""},publiccalendarids:{type:"string",default:""},uncheckedcalendarids:{type:"string",default:""},hideoptions:{type:"object",default:{hidefuture:!1,hidefuturedays:0,hidepassed:!1,hidepasseddays:0}}},edit(e){const[r,l]=(0,n.useState)(d(e.attributes.fullcalendarconfig)),[o,u]=(0,n.useState)(e.attributes.fullcalendarconfig),[p,h]=(0,n.useState)(!1),f=e.attributes.calendars;let b=0;Object.keys(f).forEach(function(e){f[e]&&(b+=1)});const g=e.attributes.config,w=e.attributes.hideoptions,y=e.attributes.fullcalendarconfig,_=e.attributes.publiccalendarids,j=e.attributes.uncheckedcalendarids,v=function(t){e.setAttributes(c(f,"calendars",this,t))},k=function(t){e.setAttributes(c(g,"config",this,t))},m=function(t){e.setAttributes(c(w,"hideoptions",this,t))},x=function(t){l(d(t)),e.setAttributes({fullcalendarconfig:""===t?"":t})};let C=null;C=Object.keys(window.pgc_selected_calendars).map(e=>{const t=window.pgc_selected_calendars[e];return(0,s.jsx)(a.CheckboxControl,{style:{backgroundColor:t.backgroundColor},className:"pgc-sidebar-row",onChange:v.bind(e),label:t.summary,checked:e in f&&f[e]})}),C.length||C.push((0,s.jsx)("em",{children:"No private calendars"})),C.push((0,s.jsx)(a.HorizontalRule,{}));const O=[["eventpopup",window.pgc_trans.eventpopup],["eventlink",window.pgc_trans.eventlink],["eventdescription",window.pgc_trans.eventdescription],["eventlocation",window.pgc_trans.eventlocation],["eventattendees",window.pgc_trans.eventattendees],["eventattachments",window.pgc_trans.eventattachments],["eventcreator",window.pgc_trans.eventcreator],["eventcalendarname",window.pgc_trans.eventcalendarname]].map(e=>(0,s.jsx)(a.CheckboxControl,{className:"pgc-sidebar-row",onChange:k.bind(e[0]),label:e[1],checked:g[e[0]]})),$=w.hidepassed?(0,s.jsx)(a.TextControl,{label:`${window.pgc_trans.more_than} ${w.hidepasseddays} ${window.pgc_trans.days_ago}`,type:"number",min:0,value:w.hidepasseddays,onChange:m.bind("hidepasseddays")}):null,E=w.hidefuture?(0,s.jsx)(a.TextControl,{label:`${window.pgc_trans.more_than} ${w.hidefuturedays} ${window.pgc_trans.days_from_now}`,type:"number",min:0,value:w.hidefuturedays,onChange:m.bind("hidefuturedays")}):null;(0,n.useEffect)(()=>{const e=wp.data.subscribe(function(){if(wp.data.select("core/editor")){const t=wp.data.select("core/editor").isSavingPost(),n=wp.data.select("core/editor").isAutosavingPost();if(t&&!n){if(!r){let t=setTimeout(function(){clearTimeout(t),wp.data.dispatch("core/notices").createWarningNotice(window.pgc_trans.malformed_json)},0);e()}if(!b&&!_){let t=setTimeout(function(){clearTimeout(t),wp.data.dispatch("core/notices").createWarningNotice(window.pgc_trans.enter_one_or_more_public_calendar_ids)},0);e()}}}});return e});const N=o?(0,s.jsxs)(n.Fragment,{children:[(0,s.jsx)(a.TextareaControl,{rows:10,onKeyDown:function(e){if(9==e.keyCode){e.preventDefault();const t=e.target,n=t.selectionStart,a=t.value.substring(0,n)+"  "+t.value.substring(t.selectionEnd);x(a);let s=setTimeout(()=>{clearTimeout(s),t.selectionEnd=n+2},0)}},className:"pgc-fullcalendarconfigarea "+(r?"":"has-error"),value:y,help:r?"":window.pgc_trans.malformed_json_short,label:window.pgc_trans.fullcalendar_config,placeHolder:i,onChange:x}),(0,s.jsxs)("div",{className:"pgc-copy-link",children:[(0,s.jsx)("a",{href:"#",onClick:e=>{e.preventDefault(),x(i)},children:window.pgc_trans.copy_default_fullcalendar_config}),(0,s.jsx)("span",{onClick:()=>h(!0),class:"dashicons dashicons-editor-help"})]})]}):null,S=p?function(e){return(0,s.jsxs)(a.Modal,{title:"FullCalendar config",onRequestClose:e.onClose,children:[(0,s.jsx)("p",{dangerouslySetInnerHTML:{__html:window.pgc_trans.copy_fullcalendar_config_info}}),(0,s.jsx)("p",{dangerouslySetInnerHTML:{__html:window.pgc_trans.fullcalendar_docs_link}})]})}({onClose:()=>{h(!1)}}):null;return(0,s.jsxs)(n.Fragment,{children:[(0,s.jsxs)(t.InspectorControls,{children:[(0,s.jsxs)(a.PanelBody,{title:window.pgc_trans.selected_calendars+" ("+(0===b?window.pgc_trans.none:b)+")",initialOpen:!0,children:[C,(0,s.jsx)(a.TextControl,{label:window.pgc_trans.comma_separated_list_calendar_ids,value:_,onChange:function(t){e.setAttributes({publiccalendarids:t})}})]}),(0,s.jsxs)(a.PanelBody,{title:window.pgc_trans.calendar_options,initialOpen:!0,children:[(0,s.jsx)(a.CheckboxControl,{className:"pgc-sidebar-row",onChange:u,label:window.pgc_trans.edit_fullcalendar_config,checked:o}),(0,s.jsx)(a.CheckboxControl,{className:"pgc-sidebar-row",onChange:m.bind("hidepassed"),label:window.pgc_trans.hide_passed_events,checked:w.hidepassed}),$,(0,s.jsx)(a.CheckboxControl,{className:"pgc-sidebar-row",onChange:m.bind("hidefuture"),label:window.pgc_trans.hide_future_events,checked:w.hidefuture}),E]}),(0,s.jsx)(a.PanelBody,{title:window.pgc_trans.theme,initialOpen:!0,children:(0,s.jsx)(a.SelectControl,{value:g.theme||"",onChange:k.bind("theme"),options:[{value:"",label:window.pgc_trans.default},...window.pgc_trans.themes.map(function(e){return{value:e,label:e}})]})}),(0,s.jsxs)(a.PanelBody,{title:window.pgc_trans.filter_options,children:[(0,s.jsx)(a.SelectControl,{value:!0===g.filter?"top":g.filter,onChange:k.bind("filter"),options:[{value:"",label:window.pgc_trans.hide_filter},{value:"top",label:window.pgc_trans.show_filter_top},{value:"bottom",label:window.pgc_trans.show_filter_bottom}]}),(0,s.jsx)(a.TextControl,{label:window.pgc_trans.filter_uncheckedcalendarids,value:j,onChange:function(t){e.setAttributes({uncheckedcalendarids:t})}})]}),(0,s.jsx)(a.PanelBody,{title:window.pgc_trans.popup_options+" ("+(g.eventpopup?window.pgc_trans.show:window.pgc_trans.hide)+")",initialOpen:!0,children:O})]}),(0,s.jsx)("div",{children:"Private Google Calendars Block"}),N,S]})},save(e){const t={},n=[],a=e.attributes.config,i=e.attributes.hideoptions,c=e.attributes.fullcalendarconfig;let d=!1;try{d=c&&Object.keys(JSON.parse(c)).length>0}catch(e){}if(d&&n.push(`fullcalendarconfig='${c}'`),Object.keys(a).forEach(function(e){"filter"===e||"theme"===e?n.push(e+'="'+a[e]+'"'):n.push(e+'="'+(a[e]?"true":"false")+'"')}),n.push(`hidepassed="${i.hidepassed?i.hidepasseddays:"false"}"`),n.push(`hidefuture="${i.hidefuture?i.hidefuturedays:"false"}"`),(e.attributes.publiccalendarids||Object.keys(e.attributes.calendars).length)&&(t.calendarids=e.attributes.publiccalendarids,Object.keys(e.attributes.calendars).length)){const n=[];Object.keys(e.attributes.calendars).forEach(function(t){t in e.attributes.calendars&&e.attributes.calendars[t]&&n.push(t)}),t.calendarids+=(t.calendarids.length&&n.length?",":"")+n.join(",")}return e.attributes.uncheckedcalendarids&&(t.uncheckedcalendarids=e.attributes.uncheckedcalendarids),Object.keys(t).forEach(function(e){n.push(e+'="'+t[e]+'"')}),(0,s.jsxs)("p",{children:["[pgc ",n.join(" "),"]"]})},deprecated:[{attributes:{calendars:{type:"object",default:{}},config:{type:"object",default:{filter:"top",eventpopup:!1,eventlink:!1,eventdescription:!1,eventlocation:!1,eventattendees:!1,eventattachments:!1,eventcreator:!1,eventcalendarname:!1}},fullcalendarconfig:{type:"string",default:""},publiccalendarids:{type:"string",default:""},uncheckedcalendarids:{type:"string",default:""},hideoptions:{type:"object",default:{hidefuture:!1,hidefuturedays:0,hidepassed:!1,hidepasseddays:0}}},save(e){const t={},n=[],a=e.attributes.config,i=e.attributes.hideoptions,c=e.attributes.fullcalendarconfig;let d=!1;try{d=c&&Object.keys(JSON.parse(c)).length>0}catch(e){}if(d&&n.push(`fullcalendarconfig='${c}'`),Object.keys(a).forEach(function(e){"filter"===e?n.push(e+'="'+a[e]+'"'):n.push(e+'="'+(a[e]?"true":"false")+'"')}),n.push(`hidepassed="${i.hidepassed?i.hidepasseddays:"false"}"`),n.push(`hidefuture="${i.hidefuture?i.hidefuturedays:"false"}"`),(e.attributes.publiccalendarids||Object.keys(e.attributes.calendars).length)&&(t.calendarids=e.attributes.publiccalendarids,Object.keys(e.attributes.calendars).length)){const n=[];Object.keys(e.attributes.calendars).forEach(function(t){t in e.attributes.calendars&&e.attributes.calendars[t]&&n.push(t)}),t.calendarids+=(t.calendarids.length&&n.length?",":"")+n.join(",")}return e.attributes.uncheckedcalendarids&&(t.uncheckedcalendarids=e.attributes.uncheckedcalendarids),Object.keys(t).forEach(function(e){n.push(e+'="'+t[e]+'"')}),(0,s.jsxs)("p",{children:["[pgc ",n.join(" "),"]"]})}},{attributes:{calendars:{type:"object",default:{}},config:{type:"object",default:{public:!1,filter:"top",eventpopup:!1,eventlink:!1,eventdescription:!1,eventlocation:!1,eventattendees:!1,eventattachments:!1,eventcreator:!1,eventcalendarname:!1}},fullcalendarconfig:{type:"string",default:""},publiccalendarids:{type:"string",default:""},uncheckedcalendarids:{type:"string",default:""},hideoptions:{type:"object",default:{hidefuture:!1,hidefuturedays:0,hidepassed:!1,hidepasseddays:0}}},save(e){const t={},n=[],a=e.attributes.config,i=e.attributes.hideoptions,c=e.attributes.fullcalendarconfig;let d=!1;try{d=c&&Object.keys(JSON.parse(c)).length>0}catch(e){}if(d&&n.push(`fullcalendarconfig='${c}'`),Object.keys(a).forEach(function(e){"filter"===e?n.push(e+'="'+a[e]+'"'):n.push(e+'="'+(a[e]?"true":"false")+'"')}),n.push(`hidepassed="${i.hidepassed?i.hidepasseddays:"false"}"`),n.push(`hidefuture="${i.hidefuture?i.hidefuturedays:"false"}"`),e.attributes.config.public)t.calendarids=e.attributes.publiccalendarids;else if(Object.keys(e.attributes.calendars).length){const n=[];Object.keys(e.attributes.calendars).forEach(function(t){t in e.attributes.calendars&&e.attributes.calendars[t]&&n.push(t)}),n.length&&(t.calendarids=n.join(","))}return e.attributes.uncheckedcalendarids&&(t.uncheckedcalendarids=e.attributes.uncheckedcalendarids),Object.keys(t).forEach(function(e){n.push(e+'="'+t[e]+'"')}),(0,s.jsxs)("p",{children:["[pgc ",n.join(" "),"]"]})}},{attributes:{calendars:{type:"object",default:{}},config:{type:"object",default:{public:!1,filter:!0,eventpopup:!1,eventlink:!1,eventdescription:!1,eventlocation:!1,eventattendees:!1,eventattachments:!1,eventcreator:!1,eventcalendarname:!1}},fullcalendarconfig:{type:"string",default:""},publiccalendarids:{type:"string",default:""},hideoptions:{type:"object",default:{hidefuture:!1,hidefuturedays:0,hidepassed:!1,hidepasseddays:0}}},save:function(e){const t={},n=[],a=e.attributes.config,i=e.attributes.hideoptions,c=e.attributes.fullcalendarconfig;let d=!1;try{d=c&&Object.keys(JSON.parse(c)).length>0}catch(e){}if(d&&n.push(`fullcalendarconfig='${c}'`),Object.keys(a).forEach(function(e){n.push(e+'="'+(a[e]?"true":"false")+'"')}),n.push(`hidepassed="${i.hidepassed?i.hidepasseddays:"false"}"`),n.push(`hidefuture="${i.hidefuture?i.hidefuturedays:"false"}"`),e.attributes.config.public)t.calendarids=e.attributes.publiccalendarids;else if(Object.keys(e.attributes.calendars).length){const n=[];Object.keys(e.attributes.calendars).forEach(function(t){t in e.attributes.calendars&&e.attributes.calendars[t]&&n.push(t)}),n.length&&(t.calendarids=n.join(","))}return Object.keys(t).forEach(function(e){n.push(e+'="'+t[e]+'"')}),(0,s.jsxs)("p",{children:["[pgc ",n.join(" "),"]"]})}}]})})();